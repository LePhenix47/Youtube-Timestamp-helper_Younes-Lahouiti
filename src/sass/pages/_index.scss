@use "../utils/" as *;

.index {
    display: grid;
    grid-template-columns: [full-width-start] minmax(325px, 1fr) auto [full-width-end];
    align-items: start;
    column-gap: 10px;

    padding-inline: 15px;
    padding-block: 30px;

    overflow-x: clip;

    @include tablet-only {
        @include center-flex-column(20px);
        align-items: stretch;
    }

    @include mobile-only {
        @include center-flex-column(15px);
        align-items: stretch;
        padding-inline: 10px;
        padding-block: 20px;
    }
}

@view-transition {
    navigation: auto;
}


::view-transition-group(root) {}

.video {
    object-fit: contain;

    width: 100%;
    height: auto;


    border-radius: inherit;


    &__container {
        @include center-flex-column;
        max-height: 100svh;

        justify-content: flex-start;

        position: relative;
        border-radius: 8px;

        // ? If the video is playing and we're not hovering the video → hide the controls (when toggle is enabled)
        &.hide-controls-on-play:not(:hover):has(>.video__controls .video-options__play-input-toggle:checked)>.video__controls {
            opacity: 0;
        }

        // &:has(.video__progress-frame.scrubbing) .video-indicators__bg-img {
        //     display: block !important;
        // }

        @include mobile-only {
            max-width: 100%;
            overflow: hidden;
        }
    }

    &__no-video {
        flex: 1;
        width: 100%;
        height: 100%;
        min-height: 425px;

        padding: 15px;

        @include center-flex-column(20px);

        --_border-color: rgb(from var(--color-primary) r g b / 50%);

        border: 2px dotted var(--_border-color);
        border-radius: 6px;

        &>* {
            pointer-events: none;
            user-select: none;
        }

        &.drag-hover {
            background-color: rgba(128, 128, 128, 25%);
            border-style: dashed;

            --_border-color: var(--color-primary);
        }
    }

    &__no-video-icon {
        font-size: 64px;
    }

    &__no-video-spinner {

        &>.square {
            --_size: 64px;
        }
    }

    &__controls {
        @include center-flex-column(15px);
        align-items: flex-start;

        --_fade-height: 100%;
        background-image: linear-gradient(0deg,
                black 0px,
                transparent var(--_fade-height));

        color: white;

        border-radius: inherit;

        width: 100%;

        padding: 5px;

        position: absolute;
        bottom: 0;

        transition: opacity 150ms ease-in-out;

        &:has(+ #video-settings-popover:popover-open) .video-options__settings-button>i {
            rotate: 30deg;
        }
    }

    &__progress {
        --_pb-height: 3;
        height: calc(var(--_pb-height) * 1px);


        width: 100%;

        position: relative;


        // ? For the total video duration
        --_video-duration-secs: 1000;

        // ? for the actual video progress
        --_current-video-progress-secs: 650;

        // ? for hover progress
        --_current-video-hover-secs: 750;

        --_total-video-progress: calc(var(--_current-video-progress-secs) / var(--_video-duration-secs) * 100%);

        --_buffer-end-secs: 860;

        --_chunks-gap: 3px;

        touch-action: none;
        user-select: none;

        &:hover .video__progress-bar-chunk:not(:hover):not(.hover-overlap),
        &:has(>.video__progress-frame.scrubbing) .video__progress-bar-chunk:not(:hover):not(.hover-overlap) {
            --_new-pb-height: 7;
            --_scale-y: calc(var(--_new-pb-height) / var(--_pb-height));

            scale: 1 var(--_scale-y);
        }
    }


    &__progress-bar-chunk {
        // ? Variable for computing stuff (my name is stuff)
        // ? Timestamps for the chunk in milliseconds to get the duration
        /* --_chunk-start-secs: 0; */
        /* --_chunk-end-secs: 500; */

        --_chunk-duration-secs: calc(var(--_chunk-end-secs) - var(--_chunk-start-secs));
        --_elapsed-time-in-chunk-secs: calc(var(--_current-video-progress-secs) - var(--_chunk-start-secs));
        --_elapsed-hover-in-chunk-secs: calc(var(--_current-video-hover-secs) - var(--_chunk-start-secs));
        --_elapsed-buffer-in-chunk: calc((var(--_buffer-end-secs) - var(--_chunk-start-secs)));

        // ? Vars for the children
        --_chunk-progress: calc(max(0, var(--_elapsed-time-in-chunk-secs)) / var(--_chunk-duration-secs) * 100%);
        --_chunk-hover-progress: calc(max(0, var(--_elapsed-hover-in-chunk-secs))/ var(--_chunk-duration-secs) * 100%);
        --_chunk-buffered-progress:
            calc(max(0, var(--_elapsed-buffer-in-chunk)) / var(--_chunk-duration-secs) * 100%);


        // ? Vars for the current chunk
        --_chunk-size: calc(var(--_chunk-duration-secs) / var(--_video-duration-secs) * 100%);
        --_chunk-position: calc(var(--_chunk-start-secs) / var(--_video-duration-secs) * 100%);

        height: 100%;

        display: flex;
        justify-content: space-between;

        position: absolute;
        isolation: isolate;

        background-color: rgba(255, 255, 255, 25%);

        width: calc(var(--_chunk-size) - var(--_chunks-gap));
        left: clamp(0%, var(--_chunk-position) + var(--_chunks-gap), 100% - var(--_chunks-gap));

        &:first-child {
            width: var(--_chunk-size);
            left: clamp(0%, var(--_chunk-position), 100%);
        }

        transition: scale 150ms ease-in-out;

        &:hover,
        &.hover-overlap {
            --_new-pb-height: 12;
            --_scale-y: calc(var(--_new-pb-height) / var(--_pb-height));

            scale: 1 var(--_scale-y);

            cursor: pointer;
        }
    }

    &__progress-chunk-progress {
        position: absolute;

        width: var(--_chunk-progress);
        max-width: 100%;

        background-color: var(--yt-color);

        height: 100%;

        &--hover-progress {
            width: var(--_chunk-hover-progress);

            position: absolute;
            z-index: -1;
            background-color: rgba(255, 255, 255, 50%);
        }

        &--buffer-progress {
            width: var(--_chunk-buffered-progress);

            position: absolute;
            z-index: -2;
            background-color: rgba(255, 255, 255, 25%);
        }
    }

    &__progress-drag-slide {
        display: flex;

        border: none;

        width: 10px;
        height: 100%;
        z-index: 1;

        --_stripe-width: 1px;
        --_stripe-gap: 2px;
        --_stripe-color: blue;

        background-image: repeating-linear-gradient(45deg,
                var(--_stripe-color) 0,
                var(--_stripe-color) var(--_stripe-width), transparent var(--_stripe-width),
                transparent calc(var(--_stripe-width) + var(--_stripe-gap)));

        outline: 1px solid rgba(255, 255, 255, 50%);

        touch-action: none;
        user-select: none;

        &:disabled {
            display: none;
        }

        // Additional styling for locked drag handles could go here
        // Currently they're hidden when disabled, which is the desired behavior

        &--start {
            --_stripe-color: yellow;
        }

        &--end {
            --_stripe-color: purple;
            margin-left: auto;
        }
    }

    &__progress-thumb {
        background-color: var(--yt-color);
        border-radius: 50%;

        --_size: 14px;

        position: absolute;
        top: calc(50% - var(--_size) / 2);
        left: clamp(0%, var(--_total-video-progress), 100%);

        anchor-name: --progress-thumb;

        translate: -50% 0%;

        z-index: 2;

        transition: scale 150ms ease-in-out;
        pointer-events: none;

        // ? If the user hovered a chunk bar where the thumb is → scale it up 
        &.scrub-chunk-overlap {
            scale: 1.5;
        }
    }


    &__progress-frame {
        @include center-flex-column(10px);

        position: absolute;
        position-anchor: --progress-thumb;

        bottom: anchor(top);

        --_frame-width: 200px;
        left: clamp(var(--_frame-width)/2, anchor(50%), 100% - var(--_frame-width)/2);

        translate: -50% 0%;

        width: var(--_frame-width);
        min-height: 150px;

        overflow: hidden;

        margin-bottom: 5px;

        color: inherit;

        transition:
            opacity 150ms ease-in-out,
            visibility 150ms ease-in-out;

        opacity: 0;
        visibility: collapse;

        &.scrubbing {
            visibility: visible;
            opacity: 1;
        }

        @include mobile-only {
            --_frame-width: min(180px, 90vw);
        }
    }

    &__progress-frame-img {
        width: 100%;
        height: 110px;
        object-fit: cover;

        border: 2px solid white;
        border-radius: 8px;
    }

    &__progress-frame-caption {
        display: inline-flex;
        flex-direction: column;
        align-items: center;

        color: white;

        text-shadow: 0 0 5px black;

        text-align: center;

        font-size: 14px;
    }

    &__progress-frame-timestamp {
        font-variant-numeric: tabular-nums;
    }
}


.video-indicators {
    position: absolute;
    inset: 0;
    pointer-events: none;

    border-radius: inherit;

    // ? We can show animations 
    &:has(+.video__controls .video-options__play-input-toggle:checked) .video-indicators__video-indicator--play {
        display: flex;
        animation: bezel-fade-out 500ms linear forwards;
    }

    &:has(+.video__controls .video-options__play-input-toggle:not(:checked)) .video-indicators__video-indicator--pause {
        display: flex;
        animation: bezel-fade-out 500ms linear forwards;
    }

    &__video-indicator-text {
        position: absolute;
        top: 27px;
        left: 50%;
        translate: -50% 0%;

        padding-block: 10px;
        padding-inline: 20px;

        font-size: 20px;

        border-radius: 3px;

        background-color: rgba(0, 0, 0, 0.5);
        color: white;
    }

    &__video-indicator {
        @include center-flex;

        position: absolute;
        top: 50%;
        left: 50%;

        translate: -50% -50%;

        --_size: 52px;
        background-color: rgba(0, 0, 0, 50%);
        color: white;
        border-radius: 50%;

    }

    &__bg-img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        border-radius: inherit;

        display: none;
    }

    &__skip {
        @include center-flex-column(10px);

        position: absolute;
        top: 50%;
        --_inline-offset: 25px;

        translate: 0 -50%;

        --_size: 110px;
        background-color: rgba(0, 0, 0, 50%);
        color: white;
        border-radius: 50%;

        /* must be in % to work */
        --_shine-width: 10%;
        --_shine-position: 50%;

        mask-size: 200% 100%;
        mask-repeat: repeat;

        mask-image: linear-gradient(45deg,
                black calc(var(--_shine-position) - var(--_shine-width)),
                transparent var(--_shine-position),
                black calc(var(--_shine-position) + var(--_shine-width)));

        mask-position: 0% 100%;
        animation: shine-animation-mask 0.5s linear;
        animation-iteration-count: 3;


        &>i {
            font-size: 24px;
        }

        &>span {
            font-size: 11px;
            user-select: none;
        }

        &--backwards {
            left: var(--_inline-offset)
        }

        &--forwards {
            right: var(--_inline-offset)
        }
    }


    &__video-buffer {
        border-radius: inherit;
        position: absolute;

        @include center-flex;



        background-color: rgba(0, 0, 0, 50%);
        width: 100%;
        height: 100%;


        &>.square {
            --_size: 64px;
        }
    }
}

@keyframes shine-animation-mask {
    0% {
        opacity: 50%;
        mask-position: 150% 100%;
    }

    50% {
        opacity: 1;

    }

    99% {
        opacity: 50%;
        mask-position: -50% 100%;
    }
}

@keyframes bezel-fade-out {
    0% {
        opacity: 1;
        scale: 1;
    }

    100% {
        opacity: 0;
        scale: 2
    }

}

.video-options {
    display: flex;
    width: 100%;

    gap: 20px;

    padding-inline: 10px;
    padding-bottom: 5px;

    @include mobile-only {
        gap: 12px;
        padding-inline: 8px;
    }

    &__video-play {
        @include center-flex;

        --_size: 20px;
        font-size: 20px;

        place-items: center;
        border: none;

        color: inherit;

        &:has(> input:checked)>.fa-play {
            display: none;
        }

        &:not(:has(> input:checked))>.fa-pause {
            display: none;
        }

        // Hide restart icon by default
        >.fa-rotate-right {
            display: none;
        }

        // When video has ended, show only restart icon
        &.video-ended {

            >.fa-play,
            >.fa-pause {
                display: none;
            }

            >.fa-rotate-right {
                display: block;
            }
        }
    }

    &__video-volume {
        height: 20px;
        width: 20px;

        overflow: clip;

        display: flex;

        align-items: center;

        transition: width 150ms ease-in-out;

        &:hover {
            width: max-content;
        }
    }

    &__video-volume-button {
        @include center-flex;

        background: none;
        border: none;
        color: inherit;

        height: 20px;
        width: 20px;

        &>i {
            @include center-flex;

            height: 20px;
            width: 20px;
            font-size: 15px;
        }
    }

    &__video-volume-range {
        width: 64px;

        height: 100%;

        --_range-height: 3px;
        --_thumb-size: 12px;

        margin-left: 15px;

        border-radius: 0px;

        --_range-bg: rgba(255, 255, 255, 0.25);
        --_progress-bg: white;

        @include mobile-only {
            width: 50px;
            margin-left: 8px;
        }
    }

    &__timestamp-info {
        font-size: 13px;

        display: flex;
        align-items: center;
        gap: 5px;
    }

    &__timestamp {
        font-variant-numeric: tabular-nums;
    }

    &__timestamp-chapter {
        color: inherit;
    }

    &__settings-button {
        @include center-flex;
        background: none;
        border: none;
        color: inherit;
        font-size: 16px;
        margin-left: auto;

        &:hover {
            opacity: 0.8;
        }

        @include mobile-only {
            font-size: 14px;
        }

        &>i {
            transition: rotate 250ms ease;
        }
    }
}

// Rotate settings button when popover is open

.video-timestamps {

    max-height: var(--_video-height, 750px);
    overflow-y: auto;

    border-radius: 5px;

    background-color: var(--ts-container-bg);

    padding: 5px;

    z-index: 1;

    @include mobile-only {
        max-width: 100%;
        overflow-x: hidden;
    }

    &__title {
        display: flex;
        justify-content: space-between;
        align-items: center;

        background-color: inherit;
        border-radius: inherit;

        position: sticky;

        --_title-padding: 5px;
        padding: var(--_title-padding);
        margin-top: calc(-1 * var(--_title-padding));
        margin-inline: calc(-1 * var(--_title-padding));

        position: sticky;
        top: calc(-1 * var(--_title-padding));

        z-index: 2;
    }

    &__add-button {
        @include center-flex;
        background-color: green;
        border-radius: 50%;
        color: white;
    }

    &__list {
        margin-top: 25px;

        @include center-flex-column(20px);
        counter-reset: timestamps;
    }

    &__item {
        display: grid;
        grid-template-columns: [full-width-start img-start] auto [img-end timestamps-controls-start] 1fr [timestamps-controls-end full-width-end];
        grid-template-rows: repeat(3, auto);
        column-gap: 20px;
        row-gap: 10px;

        padding: 10px;

        background-color: var(--ts-item-bg);
        border-radius: 5px;

        counter-increment: timestamps;
        --_border-thickness: 3px;
        border-left: var(--_border-thickness) solid transparent;
        width: calc(100% - var(--_border-thickness));

        &.chapter-locked {
            opacity: 0.8;
            border-left: var(--_border-thickness) solid #FF6B35;

            .video-timestamps__lock-icon {
                color: #FF6B35;
            }

            .video-timestamps__remove {
                opacity: 0.5;
                cursor: not-allowed;
            }
        }

        &.chapter-highlighted {
            position: relative;

            &::after {
                content: '';
                position: absolute;
                inset: 0;

                background-color: #FFD700;

                border-radius: inherit;

                mix-blend-mode: color;

                animation: chapter-highlight-overlay 2s ease-out;

                pointer-events: none;
            }
        }

        &.chapter-auto-scrolled {
            position: relative;

            &::after {
                content: '';
                position: absolute;
                inset: 0;

                background-color: #4A90E2;

                border-radius: inherit;

                mix-blend-mode: color;

                animation: chapter-highlight-overlay 2s ease-out;

                pointer-events: none;
            }
        }
    }

    &__set-current-time {
        order: 1;
        border-radius: 50%;
        background-color: var(--ts-input-bg)
    }

    &__header {
        grid-column: full-width;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
    }

    &__item-title {
        margin: 0;

        &::before {
            content: "Chapter " counter(timestamps) ": ";
        }
    }

    &__lock-toggle {
        display: flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        font-size: 12px;
        opacity: 0.7;
        transition: opacity 150ms ease-in-out;

        &:hover {
            opacity: 1;
        }
    }

    &__lock-checkbox {
        appearance: none;
        width: 14px;
        height: 14px;
        border: 1px solid currentColor;
        border-radius: 2px;
        position: relative;
        cursor: pointer;

        &:checked {
            background-color: #FF6B35;
            border-color: #FF6B35;

            &::after {
                content: '✓';
                position: absolute;
                top: 50%;
                left: 50%;
                translate: -50% -50%;
                color: white;
                font-size: 10px;
                line-height: 1;
            }
        }
    }

    &__lock-icon {
        font-size: 12px;
        transition: color 150ms ease-in-out;
    }

    &__lock-text {
        font-weight: 500;
    }

    &__img {
        object-fit: cover;

        height: 55px;

        overflow: hidden;

        border-radius: 5px;

        grid-column: img;
    }

    &__labels-container {
        display: grid;
        grid-template-columns: [full-width-label-start label-start] max-content [label-end input-start] 1fr [input-end full-width-label-end];
        row-gap: 10px;

        grid-column: timestamps-controls;
    }

    &__label {
        display: grid;
        grid-column: full-width-label;
        grid-template-columns: subgrid;
        column-gap: 10px;

        align-items: center;
    }

    &__input-container {
        display: flex;
        align-items: center;
        border-radius: 100vmax;

        &:focus-within {
            outline: 2px solid currentColor;

        }
    }

    &__input {
        flex: 1;

        --_inline-padding: 5px;
        padding: 5px 10px;

        border-radius: 100vmax;

        background-color: var(--ts-input-bg);
        color: currentColor;

        &--start {
            --_min-chars: 3;
            width: calc(var(--_inline-padding) * (5px + var(--_min-chars) * 1ch));
            text-align: center;

            --_inner-spin-appearance: none;

            &:read-only {
                opacity: 60%;

                background-color: rgba(112, 112, 112, 0.1);
                color: rgba(255, 255, 255, 0.7);
                cursor: not-allowed;
            }

            @include mobile-only {
                --_min-chars: 2.5;
                min-width: 60px;
            }
        }
    }

    &__remove {

        color: white;
        background-color: red;
        margin-left: auto;

        border-radius: 5px;
        padding: 5px 10px;


        width: 50%;

        grid-column: 2;
    }

    &__remove-text {
        width: 100%;
    }

    &__remove-icon {
        justify-self: flex-start;
        height: 10px;

        margin-top: 3px;
    }
}

.video-timestamp-outputs {
    grid-column: full-width;

    background-color: var(--ts-container-bg);
    border-radius: 5px;
    padding: 15px;
    margin-top: 20px;

    display: grid;
    gap: 15px;

    &__label {
        display: grid;
        grid-template-columns: max-content 1fr;
        column-gap: 10px;
        align-items: start;

        font-weight: 500;
    }

    &__textarea {
        background-color: var(--ts-input-bg);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 5px;
        padding: 10px;

        color: inherit;
        font-family: 'Consolas', 'Courier New', monospace;
        font-size: 12px;
        line-height: 1.4;

        resize: vertical;
        min-height: 100px;

        &:focus {
            outline: 2px solid currentColor;
            outline-offset: -2px;
        }

        &:read-only {
            opacity: 0.8;
            cursor: default;
        }
    }

    &__copy-button {
        @include center-flex;

        background-color: green;
        color: white;
        border: none;
        border-radius: 5px;

        padding: 8px 16px;
        font-size: 14px;
        font-weight: 500;

        cursor: pointer;
        transition: background-color 150ms ease-in-out;

        &:hover {
            background-color: darkgreen;
        }

        justify-self: start;
        width: max-content;
    }

    &__import-button {
        @include center-flex;

        background-color: #2196F3;
        color: white;
        border: none;
        border-radius: 5px;

        padding: 8px 16px;
        font-size: 14px;
        font-weight: 500;

        cursor: pointer;
        transition: background-color 150ms ease-in-out;

        &:hover {
            background-color: #1976D2;
        }

        justify-self: start;
        width: max-content;
    }

    // Button container for proper layout
    &__buttons {
        display: flex;
        gap: 10px;
        justify-self: start;
    }

    &__error {
        --_info-color: #3b82f6;

        display: grid;
        grid-template-columns: [icon-start] auto [icon-end text-start] 1fr [text-end];
        column-gap: 10px;
        align-items: start;

        color: var(--_info-color);
        background-color: color-mix(in srgb, var(--_info-color) 12%, transparent);
        border: 1px solid color-mix(in srgb, var(--_info-color) 40%, transparent);

        padding: 12px 16px;
        border-radius: 8px;
        font-size: 14px;
        line-height: 1.4;

        i {
            grid-column: icon;
            font-size: 16px;
        }

        >span {
            grid-column: text;

            span {
                font-weight: 600;
                color: color-mix(in srgb, var(--_info-color) 80%, black);
            }
        }

    }

    // Delete video button (already styled, just positioning)
    .video-timestamps__remove {
        justify-self: center;
        display: flex;
        align-items: center;
        gap: 8px;

        padding: 10px 20px;

        transition:
            background-color 150ms ease-in-out,
            translate 150ms ease-in-out;

        &:hover {
            background-color: darkred;
        }

        &:active {
            translate: 0% 1px;
        }
    }
}

.video-settings-popover {
    // Clean YouTube-style popover
    background-color: rgba(28, 28, 28, 0.98);
    color: white;
    border: none;
    border-radius: 12px;
    padding: 8px;
    min-width: 280px;
    max-width: 400px;
    box-shadow: 0 4px 32px rgba(0, 0, 0, 0.28);

    overflow: hidden;

    // Proper anchor positioning - top right of settings button
    position-anchor: --video-settings-button;
    top: anchor(top);
    left: anchor(right);
    margin-top: -25px;

    translate: -100% -100%;

    &__item {
        display: flex;
        align-items: center;
        width: 100%;

        padding: 8px 16px;
        cursor: pointer;
        transition: background-color 120ms ease-out;
        min-height: 48px;
        gap: 16px;

        color: white;

        user-select: none;

        &:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        &:focus {
            outline: none;
            background-color: rgba(255, 255, 255, 0.1);
        }
    }

    &__icon {
        width: 24px;
        font-size: 16px;
        opacity: 0.8;
        flex-shrink: 0;
        text-align: center;
    }

    &__label {
        flex: 1;
        font-size: 14px;
        font-weight: 400;
        color: #fff;
        line-height: 20px;
        text-align: left;
    }

    &__value {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.7);
        flex-shrink: 0;
    }

    &__toggle {
        appearance: none;
        --_track-size: 30px;
        --_thumb-size: 18px;
        width: var(--_track-size);
        height: 12px;
        background-color: rgba(255, 255, 255, 0.3);
        border-radius: 6px;
        position: relative;
        cursor: pointer;
        transition: all 150ms ease-out;
        flex-shrink: 0;

        &::before {
            content: '';
            position: absolute;
            width: var(--_thumb-size);
            height: var(--_thumb-size);
            background-color: #fff;
            border-radius: 50%;
            top: 50%;
            left: -2px;
            transform: translateY(-50%);
            transition: all 150ms ease-out;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        &:checked {
            background-color: #065fd4;

            &::before {
                left: calc(100% - var(--_thumb-size));
            }
        }

        &:hover {
            background-color: rgba(255, 255, 255, 0.4);

            &:checked {
                background-color: #4285f4;
            }
        }
    }

    // Mobile responsive
    @include mobile-only {
        min-width: 240px;
        margin-inline-start: -16px;

        &__item {
            padding: 6px 12px;
            min-height: 44px;
            gap: 12px;
        }

        &__icon {
            width: 20px;
            font-size: 14px;
        }

        &__label,
        &__value {
            font-size: 13px;
        }
    }

    // Fallback for browsers without anchor positioning
    @supports not (anchor-name: --test) {
        position: absolute;
        bottom: anchor(bottom, 0);
        right: anchor(left, 0);
        transform: none;
        margin-bottom: 8px;
        margin-right: -8px;
    }

    &__title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    &__options {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    &__option {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 150ms ease-in-out;
        border: none;
        background: none;
        color: inherit;
        font-family: inherit;
        text-align: left;
        width: 100%;

        &:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        &--button {
            justify-content: space-between;
        }
    }

    &__checkbox {
        appearance: none;
        width: 18px;
        height: 18px;
        border: 2px solid rgba(255, 255, 255, 0.6);
        border-radius: 3px;
        position: relative;
        cursor: pointer;
        transition: all 150ms ease-in-out;

        &:checked {
            background-color: var(--yt-color, #ff0033);
            border-color: var(--yt-color, #ff0033);

            &::after {
                content: '✓';
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: white;
                font-size: 12px;
                font-weight: bold;
            }
        }

        &:hover {
            border-color: white;
        }
    }

    &__label {
        flex: 1;
        font-size: 14px;
        font-weight: 500;
    }

    &__icon {
        font-size: 14px;
        opacity: 0.8;
        flex-shrink: 0;
    }

    &__speed-value {
        font-size: 13px;
        color: var(--yt-color, #ff0033);
        font-weight: 600;
        min-width: 25px;
        text-align: center;
    }

    // Responsive
    @include mobile-only {
        min-width: 200px;
        padding: 12px;

        &__title {
            font-size: 15px;
        }

        &__label {
            font-size: 13px;
        }

        &__checkbox {
            width: 16px;
            height: 16px;

            &::after {
                font-size: 10px;
            }
        }
    }
}

// Anchor name for the settings button
#video-settings-button {
    anchor-name: --video-settings-button;
}

// Video Settings Carousel
.video-settings-carousel {
    position: relative;
    height: var(--_carousel-height, auto);
    transition: height 300ms ease-in-out;

    // Container query support for responsive behavior
    container-type: inline-size;
}

.video-settings-section {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;

    // Smooth transitions
    opacity: 1;
    transform: translateX(0);
    transition: opacity 300ms ease-in-out, transform 300ms ease-in-out;

    // Remove default list styling
    list-style: none;
    margin: 0;
    padding: 0;

    // Hidden state - slide right and fade out
    &:not(&--active) {
        opacity: 0;
        transform: translateX(100%);
        pointer-events: none; // Prevent interaction with hidden sections
    }

    // Main settings section styles (inherits existing popover item styles)
    &--main {
        // Uses existing .video-settings-popover__item styles
    }

    // Speed settings section styles  
    &--speed {
        padding: 8px 0;
    }
}

// Speed Controls (First Slide)
.speed-controls {
    display: flex;
    flex-direction: column;
    gap: 16px;

    &__header {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 8px 0;
    }

    &__back {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: white;
        cursor: pointer;
        transition: background-color 150ms ease;

        display: flex;
        align-items: center;
        justify-content: center;

        &:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        i {
            font-size: 14px;
        }
    }

    &__title {
        font-size: 16px;
        font-weight: 600;
        color: white;
        flex: 1;
    }

    &__display {
        text-align: center;
        padding: 8px 0;
    }

    &__current {
        font-size: 24px;
        font-weight: 600;
        color: #fff;
    }

    &__adjustment {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    &__button {
        --_size: 25px;

        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);

        color: white;
        cursor: pointer;
        transition: background-color 150ms ease;

        display: flex;
        align-items: center;
        justify-content: center;

        &:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        &:active {
            background: rgba(255, 255, 255, 0.3);
        }

        i {
            font-size: 12px;
        }
    }

    &__slider-container {
        flex: 1;
    }

    &__slider {
        width: 100%;

        --_progress-bg: white;
    }

    &__presets {
        display: flex;
        justify-content: space-between;
        gap: 8px;
        margin-top: 8px;
    }

    &__preset {
        flex: 1;
        padding: 5px 8px;
        border-radius: 6px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        cursor: pointer;
        transition: all 150ms ease;
        font-size: 13px;

        &:has(input:checked) {
            background: white;
            color: black;
        }

        @include center-flex;

        &:hover {
            background: rgba(255, 255, 255, 0.2);
        }
    }
}

// Speed Advanced (Second Slide - Example)
.speed-advanced {
    display: flex;
    flex-direction: column;
    gap: 12px;
    text-align: center;

    &__title {
        font-size: 16px;
        font-weight: 600;
        color: white;
        margin: 0;
    }

    &__description {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.8);
        margin: 0;
    }

    &__back {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 10px 16px;
        border-radius: 6px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        background: rgba(255, 255, 255, 0.1);
        color: white;
        cursor: pointer;
        transition: background-color 150ms ease;

        &:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        i {
            font-size: 12px;
        }
    }
}

// Ambient mode - apply blur filter when ambient mode toggle is checked
.video__container:has([data-element="ambient-mode-toggle"]:checked) .video {
    filter: url(#blur-and-scale);
    transition: filter 300ms ease;
}